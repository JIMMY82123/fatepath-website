<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FatePath - 谷歌搜索诊断页面</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #fbbf24;
            margin-bottom: 10px;
        }
        .diagnostic-section {
            background: #2a2a2a;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            border-left: 4px solid #fbbf24;
        }
        .diagnostic-section h3 {
            color: #fbbf24;
            margin-top: 0;
        }
        .status {
            padding: 8px 12px;
            border-radius: 4px;
            margin: 5px 0;
            font-weight: 500;
        }
        .status.success { background: #065f46; color: #d1fae5; }
        .status.warning { background: #92400e; color: #fef3c7; }
        .status.error { background: #991b1b; color: #fee2e2; }
        .status.info { background: #1e40af; color: #dbeafe; }
        .button {
            background: #fbbf24;
            color: #1a1a1a;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 14px;
        }
        .button:hover {
            background: #f59e0b;
        }
        .log {
            background: #000;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .test-links {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        .test-links a {
            background: #374151;
            color: white;
            padding: 10px 16px;
            text-decoration: none;
            border-radius: 6px;
            font-size: 14px;
        }
        .test-links a:hover {
            background: #4b5563;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔍 FatePath 谷歌搜索诊断页面</h1>
            <p>专门用于诊断从谷歌搜索结果直接访问时的白屏问题</p>
        </div>

        <div class="diagnostic-section">
            <h3>📱 设备信息</h3>
            <div id="device-info"></div>
        </div>

        <div class="diagnostic-section">
            <h3>🌐 访问信息</h3>
            <div id="access-info"></div>
        </div>

        <div class="diagnostic-section">
            <h3>🔧 技术诊断</h3>
            <div id="tech-diagnostic"></div>
        </div>

        <div class="diagnostic-section">
            <h3>🧪 测试操作</h3>
            <div class="test-links">
                <a href="/" target="_blank">测试主页加载</a>
                <a href="/src/main.jsx" target="_blank">测试React脚本</a>
                <a href="/src/App.jsx" target="_blank">测试App组件</a>
                <a href="/src/pages/Home.jsx" target="_blank">测试Home页面</a>
            </div>
            <button class="button" onclick="testReactApp()">测试React应用加载</button>
            <button class="button" onclick="simulateGoogleSearch()">模拟谷歌搜索访问</button>
            <button class="button" onclick="clearLog()">清除日志</button>
        </div>

        <div class="diagnostic-section">
            <h3>📋 诊断日志</h3>
            <div id="diagnostic-log" class="log"></div>
        </div>
    </div>

    <script>
        // 诊断日志系统
        function log(message, type = 'info') {
            const logElement = document.getElementById('diagnostic-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            logElement.textContent += logEntry;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function clearLog() {
            document.getElementById('diagnostic-log').textContent = '';
            log('日志已清除');
        }

        // 设备信息检测
        function detectDeviceInfo() {
            const deviceInfo = document.getElementById('device-info');
            const userAgent = navigator.userAgent;
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            const pixelRatio = window.devicePixelRatio;

            deviceInfo.innerHTML = `
                <div class="status ${isMobile ? 'warning' : 'info'}">
                    📱 设备类型: ${isMobile ? '移动设备' : '桌面设备'}
                </div>
                <div class="status info">
                    🖥️ 屏幕尺寸: ${screenWidth} × ${screenHeight}
                </div>
                <div class="status info">
                    🔍 像素比例: ${pixelRatio}
                </div>
                <div class="status info">
                    🌐 User Agent: ${userAgent.substring(0, 100)}...
                </div>
            `;

            log(`设备检测完成 - 移动设备: ${isMobile}, 屏幕: ${screenWidth}x${screenHeight}`);
        }

        // 访问信息检测
        function detectAccessInfo() {
            const accessInfo = document.getElementById('access-info');
            const referrer = document.referrer;
            const url = window.location.href;
            const isDirectAccess = !referrer;
            const isGoogleSearch = referrer && referrer.includes('google.com');
            const isGoogleAds = referrer && (referrer.includes('googleadservices.com') || referrer.includes('doubleclick.net'));

            accessInfo.innerHTML = `
                <div class="status ${isDirectAccess ? 'warning' : 'info'}">
                    🚪 访问方式: ${isDirectAccess ? '直接访问' : '从其他页面进入'}
                </div>
                <div class="status ${isGoogleSearch ? 'warning' : 'info'}">
                    🔍 来源: ${isGoogleSearch ? '谷歌搜索' : (isGoogleAds ? '谷歌广告' : referrer || '未知')}
                </div>
                <div class="status info">
                    📍 当前URL: ${url}
                </div>
                <div class="status ${referrer ? 'success' : 'error'}">
                    🔗 Referrer: ${referrer || '无'}
                </div>
            `;

            log(`访问信息检测完成 - 直接访问: ${isDirectAccess}, 来源: ${referrer || '无'}`);
        }

        // 技术诊断
        function performTechDiagnostic() {
            const techDiagnostic = document.getElementById('tech-diagnostic');
            const rootElement = document.getElementById('root');
            const hasRoot = !!rootElement;
            const rootChildren = rootElement ? rootElement.children.length : 0;
            const scripts = document.querySelectorAll('script');
            const reactScripts = Array.from(scripts).filter(s => s.src && s.src.includes('main.jsx'));

            techDiagnostic.innerHTML = `
                <div class="status ${hasRoot ? 'success' : 'error'}">
                    🎯 Root元素: ${hasRoot ? '存在' : '不存在'}
                </div>
                <div class="status ${rootChildren > 0 ? 'success' : 'warning'}">
                    👶 Root子元素: ${rootChildren} 个
                </div>
                <div class="status ${reactScripts.length > 0 ? 'success' : 'error'}">
                    ⚛️ React脚本: ${reactScripts.length} 个
                </div>
                <div class="status info">
                    📜 总脚本数量: ${scripts.length} 个
                </div>
            `;

            log(`技术诊断完成 - Root: ${hasRoot}, 子元素: ${rootChildren}, React脚本: ${reactScripts.length}`);
        }

        // 测试React应用加载
        function testReactApp() {
            log('🧪 开始测试React应用加载...');
            
            // 检查main.jsx是否存在
            fetch('/src/main.jsx')
                .then(response => {
                    if (response.ok) {
                        log('✅ main.jsx 文件存在且可访问', 'success');
                        return response.text();
                    } else {
                        log('❌ main.jsx 文件无法访问', 'error');
                        throw new Error('main.jsx not accessible');
                    }
                })
                .then(content => {
                    log(`📄 main.jsx 内容长度: ${content.length} 字符`, 'info');
                    if (content.includes('React')) {
                        log('✅ main.jsx 包含React相关代码', 'success');
                    } else {
                        log('⚠️ main.jsx 可能不包含React代码', 'warning');
                    }
                })
                .catch(error => {
                    log(`❌ 测试React应用失败: ${error.message}`, 'error');
                });
        }

        // 模拟谷歌搜索访问
        function simulateGoogleSearch() {
            log('🔍 模拟谷歌搜索访问...');
            
            // 模拟referrer
            Object.defineProperty(document, 'referrer', {
                value: 'https://www.google.com/search?q=fatepath.me',
                writable: false
            });
            
            log('✅ 已模拟谷歌搜索referrer', 'success');
            detectAccessInfo();
        }

        // 页面加载完成后的诊断
        window.addEventListener('load', function() {
            log('🚀 页面加载完成，开始诊断...');
            detectDeviceInfo();
            detectAccessInfo();
            performTechDiagnostic();
            
            // 延迟检查，看看是否有动态内容加载
            setTimeout(() => {
                log('⏰ 延迟检查开始...');
                performTechDiagnostic();
                
                // 检查是否有React应用加载
                const root = document.getElementById('root');
                if (root && root.children.length === 0) {
                    log('⚠️ 页面仍然为空，可能存在白屏问题', 'warning');
                } else {
                    log('✅ 页面有内容，React应用可能已加载', 'success');
                }
            }, 3000);
        });

        // 错误监听
        window.addEventListener('error', function(event) {
            log(`🚨 页面错误: ${event.message}`, 'error');
        });

        window.addEventListener('unhandledrejection', function(event) {
            log(`🚨 未处理的Promise拒绝: ${event.reason}`, 'error');
        });

        // 定期检查页面状态
        setInterval(() => {
            const root = document.getElementById('root');
            if (root && root.children.length === 0) {
                log('⚠️ 定期检查: 页面仍然为空', 'warning');
            }
        }, 5000);

        log('🔧 诊断页面初始化完成');
    </script>
</body>
</html>
