<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FatePath - è°·æ­Œæœç´¢è¯Šæ–­é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #fbbf24;
            margin-bottom: 10px;
        }
        .diagnostic-section {
            background: #2a2a2a;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            border-left: 4px solid #fbbf24;
        }
        .diagnostic-section h3 {
            color: #fbbf24;
            margin-top: 0;
        }
        .status {
            padding: 8px 12px;
            border-radius: 4px;
            margin: 5px 0;
            font-weight: 500;
        }
        .status.success { background: #065f46; color: #d1fae5; }
        .status.warning { background: #92400e; color: #fef3c7; }
        .status.error { background: #991b1b; color: #fee2e2; }
        .status.info { background: #1e40af; color: #dbeafe; }
        .button {
            background: #fbbf24;
            color: #1a1a1a;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 14px;
        }
        .button:hover {
            background: #f59e0b;
        }
        .log {
            background: #000;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .test-links {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        .test-links a {
            background: #374151;
            color: white;
            padding: 10px 16px;
            text-decoration: none;
            border-radius: 6px;
            font-size: 14px;
        }
        .test-links a:hover {
            background: #4b5563;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” FatePath è°·æ­Œæœç´¢è¯Šæ–­é¡µé¢</h1>
            <p>ä¸“é—¨ç”¨äºè¯Šæ–­ä»è°·æ­Œæœç´¢ç»“æœç›´æ¥è®¿é—®æ—¶çš„ç™½å±é—®é¢˜</p>
        </div>

        <div class="diagnostic-section">
            <h3>ğŸ“± è®¾å¤‡ä¿¡æ¯</h3>
            <div id="device-info"></div>
        </div>

        <div class="diagnostic-section">
            <h3>ğŸŒ è®¿é—®ä¿¡æ¯</h3>
            <div id="access-info"></div>
        </div>

        <div class="diagnostic-section">
            <h3>ğŸ”§ æŠ€æœ¯è¯Šæ–­</h3>
            <div id="tech-diagnostic"></div>
        </div>

        <div class="diagnostic-section">
            <h3>ğŸ§ª æµ‹è¯•æ“ä½œ</h3>
            <div class="test-links">
                <a href="/" target="_blank">æµ‹è¯•ä¸»é¡µåŠ è½½</a>
                <a href="/src/main.jsx" target="_blank">æµ‹è¯•Reactè„šæœ¬</a>
                <a href="/src/App.jsx" target="_blank">æµ‹è¯•Appç»„ä»¶</a>
                <a href="/src/pages/Home.jsx" target="_blank">æµ‹è¯•Homeé¡µé¢</a>
            </div>
            <button class="button" onclick="testReactApp()">æµ‹è¯•Reactåº”ç”¨åŠ è½½</button>
            <button class="button" onclick="simulateGoogleSearch()">æ¨¡æ‹Ÿè°·æ­Œæœç´¢è®¿é—®</button>
            <button class="button" onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
        </div>

        <div class="diagnostic-section">
            <h3>ğŸ“‹ è¯Šæ–­æ—¥å¿—</h3>
            <div id="diagnostic-log" class="log"></div>
        </div>
    </div>

    <script>
        // è¯Šæ–­æ—¥å¿—ç³»ç»Ÿ
        function log(message, type = 'info') {
            const logElement = document.getElementById('diagnostic-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            logElement.textContent += logEntry;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function clearLog() {
            document.getElementById('diagnostic-log').textContent = '';
            log('æ—¥å¿—å·²æ¸…é™¤');
        }

        // è®¾å¤‡ä¿¡æ¯æ£€æµ‹
        function detectDeviceInfo() {
            const deviceInfo = document.getElementById('device-info');
            const userAgent = navigator.userAgent;
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            const pixelRatio = window.devicePixelRatio;

            deviceInfo.innerHTML = `
                <div class="status ${isMobile ? 'warning' : 'info'}">
                    ğŸ“± è®¾å¤‡ç±»å‹: ${isMobile ? 'ç§»åŠ¨è®¾å¤‡' : 'æ¡Œé¢è®¾å¤‡'}
                </div>
                <div class="status info">
                    ğŸ–¥ï¸ å±å¹•å°ºå¯¸: ${screenWidth} Ã— ${screenHeight}
                </div>
                <div class="status info">
                    ğŸ” åƒç´ æ¯”ä¾‹: ${pixelRatio}
                </div>
                <div class="status info">
                    ğŸŒ User Agent: ${userAgent.substring(0, 100)}...
                </div>
            `;

            log(`è®¾å¤‡æ£€æµ‹å®Œæˆ - ç§»åŠ¨è®¾å¤‡: ${isMobile}, å±å¹•: ${screenWidth}x${screenHeight}`);
        }

        // è®¿é—®ä¿¡æ¯æ£€æµ‹
        function detectAccessInfo() {
            const accessInfo = document.getElementById('access-info');
            const referrer = document.referrer;
            const url = window.location.href;
            const isDirectAccess = !referrer;
            const isGoogleSearch = referrer && referrer.includes('google.com');
            const isGoogleAds = referrer && (referrer.includes('googleadservices.com') || referrer.includes('doubleclick.net'));

            accessInfo.innerHTML = `
                <div class="status ${isDirectAccess ? 'warning' : 'info'}">
                    ğŸšª è®¿é—®æ–¹å¼: ${isDirectAccess ? 'ç›´æ¥è®¿é—®' : 'ä»å…¶ä»–é¡µé¢è¿›å…¥'}
                </div>
                <div class="status ${isGoogleSearch ? 'warning' : 'info'}">
                    ğŸ” æ¥æº: ${isGoogleSearch ? 'è°·æ­Œæœç´¢' : (isGoogleAds ? 'è°·æ­Œå¹¿å‘Š' : referrer || 'æœªçŸ¥')}
                </div>
                <div class="status info">
                    ğŸ“ å½“å‰URL: ${url}
                </div>
                <div class="status ${referrer ? 'success' : 'error'}">
                    ğŸ”— Referrer: ${referrer || 'æ— '}
                </div>
            `;

            log(`è®¿é—®ä¿¡æ¯æ£€æµ‹å®Œæˆ - ç›´æ¥è®¿é—®: ${isDirectAccess}, æ¥æº: ${referrer || 'æ— '}`);
        }

        // æŠ€æœ¯è¯Šæ–­
        function performTechDiagnostic() {
            const techDiagnostic = document.getElementById('tech-diagnostic');
            const rootElement = document.getElementById('root');
            const hasRoot = !!rootElement;
            const rootChildren = rootElement ? rootElement.children.length : 0;
            const scripts = document.querySelectorAll('script');
            const reactScripts = Array.from(scripts).filter(s => s.src && s.src.includes('main.jsx'));

            techDiagnostic.innerHTML = `
                <div class="status ${hasRoot ? 'success' : 'error'}">
                    ğŸ¯ Rootå…ƒç´ : ${hasRoot ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}
                </div>
                <div class="status ${rootChildren > 0 ? 'success' : 'warning'}">
                    ğŸ‘¶ Rootå­å…ƒç´ : ${rootChildren} ä¸ª
                </div>
                <div class="status ${reactScripts.length > 0 ? 'success' : 'error'}">
                    âš›ï¸ Reactè„šæœ¬: ${reactScripts.length} ä¸ª
                </div>
                <div class="status info">
                    ğŸ“œ æ€»è„šæœ¬æ•°é‡: ${scripts.length} ä¸ª
                </div>
            `;

            log(`æŠ€æœ¯è¯Šæ–­å®Œæˆ - Root: ${hasRoot}, å­å…ƒç´ : ${rootChildren}, Reactè„šæœ¬: ${reactScripts.length}`);
        }

        // æµ‹è¯•Reactåº”ç”¨åŠ è½½
        function testReactApp() {
            log('ğŸ§ª å¼€å§‹æµ‹è¯•Reactåº”ç”¨åŠ è½½...');
            
            // æ£€æŸ¥main.jsxæ˜¯å¦å­˜åœ¨
            fetch('/src/main.jsx')
                .then(response => {
                    if (response.ok) {
                        log('âœ… main.jsx æ–‡ä»¶å­˜åœ¨ä¸”å¯è®¿é—®', 'success');
                        return response.text();
                    } else {
                        log('âŒ main.jsx æ–‡ä»¶æ— æ³•è®¿é—®', 'error');
                        throw new Error('main.jsx not accessible');
                    }
                })
                .then(content => {
                    log(`ğŸ“„ main.jsx å†…å®¹é•¿åº¦: ${content.length} å­—ç¬¦`, 'info');
                    if (content.includes('React')) {
                        log('âœ… main.jsx åŒ…å«Reactç›¸å…³ä»£ç ', 'success');
                    } else {
                        log('âš ï¸ main.jsx å¯èƒ½ä¸åŒ…å«Reactä»£ç ', 'warning');
                    }
                })
                .catch(error => {
                    log(`âŒ æµ‹è¯•Reactåº”ç”¨å¤±è´¥: ${error.message}`, 'error');
                });
        }

        // æ¨¡æ‹Ÿè°·æ­Œæœç´¢è®¿é—®
        function simulateGoogleSearch() {
            log('ğŸ” æ¨¡æ‹Ÿè°·æ­Œæœç´¢è®¿é—®...');
            
            // æ¨¡æ‹Ÿreferrer
            Object.defineProperty(document, 'referrer', {
                value: 'https://www.google.com/search?q=fatepath.me',
                writable: false
            });
            
            log('âœ… å·²æ¨¡æ‹Ÿè°·æ­Œæœç´¢referrer', 'success');
            detectAccessInfo();
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„è¯Šæ–­
        window.addEventListener('load', function() {
            log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è¯Šæ–­...');
            detectDeviceInfo();
            detectAccessInfo();
            performTechDiagnostic();
            
            // å»¶è¿Ÿæ£€æŸ¥ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰åŠ¨æ€å†…å®¹åŠ è½½
            setTimeout(() => {
                log('â° å»¶è¿Ÿæ£€æŸ¥å¼€å§‹...');
                performTechDiagnostic();
                
                // æ£€æŸ¥æ˜¯å¦æœ‰Reactåº”ç”¨åŠ è½½
                const root = document.getElementById('root');
                if (root && root.children.length === 0) {
                    log('âš ï¸ é¡µé¢ä»ç„¶ä¸ºç©ºï¼Œå¯èƒ½å­˜åœ¨ç™½å±é—®é¢˜', 'warning');
                } else {
                    log('âœ… é¡µé¢æœ‰å†…å®¹ï¼ŒReactåº”ç”¨å¯èƒ½å·²åŠ è½½', 'success');
                }
            }, 3000);
        });

        // é”™è¯¯ç›‘å¬
        window.addEventListener('error', function(event) {
            log(`ğŸš¨ é¡µé¢é”™è¯¯: ${event.message}`, 'error');
        });

        window.addEventListener('unhandledrejection', function(event) {
            log(`ğŸš¨ æœªå¤„ç†çš„Promiseæ‹’ç»: ${event.reason}`, 'error');
        });

        // å®šæœŸæ£€æŸ¥é¡µé¢çŠ¶æ€
        setInterval(() => {
            const root = document.getElementById('root');
            if (root && root.children.length === 0) {
                log('âš ï¸ å®šæœŸæ£€æŸ¥: é¡µé¢ä»ç„¶ä¸ºç©º', 'warning');
            }
        }, 5000);

        log('ğŸ”§ è¯Šæ–­é¡µé¢åˆå§‹åŒ–å®Œæˆ');
    </script>
</body>
</html>
