<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§»åŠ¨ç«¯æµ‹è¯•é¡µé¢ - FatePath</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
            line-height: 1.6;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 10px;
        }
        
        .header h1 {
            color: #fbbf24;
            margin-bottom: 10px;
        }
        
        .test-section {
            background: #2a2a2a;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 10px;
        }
        
        .test-section h2 {
            color: #fbbf24;
            margin-bottom: 15px;
            border-bottom: 2px solid #fbbf24;
            padding-bottom: 10px;
        }
        
        .test-button {
            background: #fbbf24;
            color: #1a1a1a;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            background: #f59e0b;
            transform: translateY(-2px);
        }
        
        .test-button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            background: #333;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .success { border-left: 4px solid #10b981; }
        .warning { border-left: 4px solid #f59e0b; }
        .error { border-left: 4px solid #ef4444; }
        
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status.success { background: #10b981; color: white; }
        .status.warning { background: #f59e0b; color: white; }
        .status.error { background: #ef4444; color: white; }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .info-item {
            background: #333;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }
        
        .info-item strong {
            color: #fbbf24;
            display: block;
            margin-bottom: 5px;
        }
        
        @media (max-width: 768px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .test-button {
                width: 100%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ ç§»åŠ¨ç«¯é—®é¢˜è¯Šæ–­å·¥å…·</h1>
            <p>ä¸“é—¨ç”¨äºæµ‹è¯•å’Œä¿®å¤è°·æ­Œå¹¿å‘Šç›´æ¥è®¿é—®é—®é¢˜</p>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“± è®¾å¤‡ä¿¡æ¯æ£€æµ‹</h2>
            <div id="device-info" class="result">
                ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹æ£€æµ‹...
            </div>
            <button class="test-button" onclick="checkDeviceInfo()">æ£€æµ‹è®¾å¤‡ä¿¡æ¯</button>
        </div>
        
        <div class="test-section">
            <h2>ğŸŒ ç½‘ç»œå’Œæ€§èƒ½æ£€æµ‹</h2>
            <div id="network-info" class="result">
                ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹æ£€æµ‹...
            </div>
            <button class="test-button" onclick="checkNetworkInfo()">æ£€æµ‹ç½‘ç»œæ€§èƒ½</button>
        </div>
        
        <div class="test-section">
            <h2>ğŸ” è®¿é—®æ¥æºæ£€æµ‹</h2>
            <div id="referrer-info" class="result">
                ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹æ£€æµ‹...
            </div>
            <button class="test-button" onclick="checkReferrerInfo()">æ£€æµ‹è®¿é—®æ¥æº</button>
        </div>
        
        <div class="test-section">
            <h2>âš¡ é¡µé¢åŠ è½½æµ‹è¯•</h2>
            <div id="loading-test" class="result">
                ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...
            </div>
            <button class="test-button" onclick="testPageLoading()">æµ‹è¯•é¡µé¢åŠ è½½</button>
        </div>
        
        <div class="test-section">
            <h2>ğŸ› ï¸ ä¿®å¤åŠŸèƒ½æµ‹è¯•</h2>
            <div id="fix-test" class="result">
                ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...
            </div>
            <button class="test-button" onclick="testFixFunctions()">æµ‹è¯•ä¿®å¤åŠŸèƒ½</button>
            <button class="test-button" onclick="simulateDirectAccess()">æ¨¡æ‹Ÿç›´æ¥è®¿é—®</button>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“Š ç»¼åˆè¯Šæ–­æŠ¥å‘Š</h2>
            <div id="comprehensive-report" class="result">
                ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ç”ŸæˆæŠ¥å‘Š...
            </div>
            <button class="test-button" onclick="generateComprehensiveReport()">ç”Ÿæˆç»¼åˆæŠ¥å‘Š</button>
            <button class="test-button" onclick="exportReport()">å¯¼å‡ºæŠ¥å‘Š</button>
        </div>
        
        <div class="test-section">
            <h2>ğŸ”— å¿«é€Ÿå¯¼èˆª</h2>
            <button class="test-button" onclick="goToHome()">å‰å¾€ä¸»é¡µ</button>
            <button class="test-button" onclick="goToServices()">å‰å¾€æœåŠ¡é¡µé¢</button>
            <button class="test-button" onclick="goToContact()">å‰å¾€è”ç³»é¡µé¢</button>
            <button class="test-button" onclick="refreshPage()">åˆ·æ–°é¡µé¢</button>
        </div>
    </div>

    <script>
        // è®¾å¤‡ä¿¡æ¯æ£€æµ‹
        function checkDeviceInfo() {
            const result = document.getElementById('device-info');
            result.innerHTML = 'æ­£åœ¨æ£€æµ‹è®¾å¤‡ä¿¡æ¯...';
            
            try {
                const deviceInfo = {
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    language: navigator.language,
                    cookieEnabled: navigator.cookieEnabled,
                    onLine: navigator.onLine,
                    screenSize: `${window.screen.width}x${window.screen.height}`,
                    viewportSize: `${window.innerWidth}x${window.innerHeight}`,
                    pixelRatio: window.devicePixelRatio || 1,
                    memory: navigator.deviceMemory || 'unknown',
                    cores: navigator.hardwareConcurrency || 'unknown',
                    touchSupport: 'ontouchstart' in window,
                    orientation: window.screen.orientation?.type || 'unknown'
                };
                
                result.innerHTML = JSON.stringify(deviceInfo, null, 2);
                result.className = 'result success';
            } catch (error) {
                result.innerHTML = `æ£€æµ‹å¤±è´¥: ${error.message}`;
                result.className = 'result error';
            }
        }
        
        // ç½‘ç»œå’Œæ€§èƒ½æ£€æµ‹
        function checkNetworkInfo() {
            const result = document.getElementById('network-info');
            result.innerHTML = 'æ­£åœ¨æ£€æµ‹ç½‘ç»œä¿¡æ¯...';
            
            try {
                const networkInfo = {
                    connection: navigator.connection ? {
                        effectiveType: navigator.connection.effectiveType,
                        downlink: navigator.connection.downlink,
                        rtt: navigator.connection.rtt,
                        saveData: navigator.connection.saveData
                    } : 'Not supported',
                    performance: {
                        navigationStart: performance.timing?.navigationStart || 'Not available',
                        loadEventEnd: performance.timing?.loadEventEnd || 'Not available',
                        domContentLoaded: performance.timing?.domContentLoadedEventEnd || 'Not available'
                    },
                    memory: performance.memory ? {
                        usedJSHeapSize: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024) + ' MB',
                        totalJSHeapSize: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024) + ' MB',
                        jsHeapSizeLimit: Math.round(performance.memory.jsHeapSizeLimit / 1024 / 1024) + ' MB'
                    } : 'Not available'
                };
                
                result.innerHTML = JSON.stringify(networkInfo, null, 2);
                result.className = 'result success';
            } catch (error) {
                result.innerHTML = `æ£€æµ‹å¤±è´¥: ${error.message}`;
                result.className = 'result error';
            }
        }
        
        // è®¿é—®æ¥æºæ£€æµ‹
        function checkReferrerInfo() {
            const result = document.getElementById('referrer-info');
            result.innerHTML = 'æ­£åœ¨æ£€æµ‹è®¿é—®æ¥æº...';
            
            try {
                const referrerInfo = {
                    referrer: document.referrer || 'No referrer (direct access)',
                    url: window.location.href,
                    pathname: window.location.pathname,
                    search: window.location.search,
                    hash: window.location.hash,
                    timestamp: new Date().toISOString(),
                    isDirectAccess: !document.referrer,
                    isGoogleAds: document.referrer && (
                        document.referrer.includes('google.com') ||
                        document.referrer.includes('googleadservices.com') ||
                        document.referrer.includes('doubleclick.net') ||
                        document.referrer.includes('googlesyndication.com')
                    )
                };
                
                result.innerHTML = JSON.stringify(referrerInfo, null, 2);
                result.className = 'result success';
            } catch (error) {
                result.innerHTML = `æ£€æµ‹å¤±è´¥: ${error.message}`;
                result.className = 'result error';
            }
        }
        
        // é¡µé¢åŠ è½½æµ‹è¯•
        function testPageLoading() {
            const result = document.getElementById('loading-test');
            result.innerHTML = 'æ­£åœ¨æµ‹è¯•é¡µé¢åŠ è½½...';
            
            try {
                const startTime = performance.now();
                
                // æ¨¡æ‹Ÿé¡µé¢åŠ è½½æµ‹è¯•
                setTimeout(() => {
                    const loadTime = performance.now() - startTime;
                    const loadInfo = {
                        loadTime: Math.round(loadTime) + ' ms',
                        domReady: document.readyState,
                        performance: {
                            navigationStart: performance.timing?.navigationStart || 'Not available',
                            loadEventEnd: performance.timing?.loadEventEnd || 'Not available'
                        },
                        resources: performance.getEntriesByType('resource').length,
                        recommendations: []
                    };
                    
                    if (loadTime > 3000) {
                        loadInfo.recommendations.push('é¡µé¢åŠ è½½æ—¶é—´è¾ƒé•¿ï¼Œå»ºè®®ä¼˜åŒ–');
                    }
                    
                    if (document.readyState !== 'complete') {
                        loadInfo.recommendations.push('DOMæœªå®Œå…¨åŠ è½½');
                    }
                    
                    result.innerHTML = JSON.stringify(loadInfo, null, 2);
                    result.className = loadInfo.recommendations.length > 0 ? 'result warning' : 'result success';
                }, 1000);
                
            } catch (error) {
                result.innerHTML = `æµ‹è¯•å¤±è´¥: ${error.message}`;
                result.className = 'result error';
            }
        }
        
        // ä¿®å¤åŠŸèƒ½æµ‹è¯•
        function testFixFunctions() {
            const result = document.getElementById('fix-test');
            result.innerHTML = 'æ­£åœ¨æµ‹è¯•ä¿®å¤åŠŸèƒ½...';
            
            try {
                const fixTest = {
                    mobileErrorBoundary: typeof MobileErrorBoundary !== 'undefined',
                    mobilePerformanceMonitor: typeof MobilePerformanceMonitor !== 'undefined',
                    mobileOptimization: typeof mobileOptimization !== 'undefined',
                    mobileDiagnostics: typeof mobileDiagnostics !== 'undefined',
                    fixGoogleAdsDirectAccess: typeof window.fixGoogleAdsDirectAccess !== 'undefined',
                    testResults: []
                };
                
                // æµ‹è¯•å„ç§ä¿®å¤åŠŸèƒ½
                if (fixTest.mobileErrorBoundary) {
                    fixTest.testResults.push('âœ… ç§»åŠ¨ç«¯é”™è¯¯è¾¹ç•Œå¯ç”¨');
                } else {
                    fixTest.testResults.push('âŒ ç§»åŠ¨ç«¯é”™è¯¯è¾¹ç•Œä¸å¯ç”¨');
                }
                
                if (fixTest.fixGoogleAdsDirectAccess) {
                    fixTest.testResults.push('âœ… è°·æ­Œå¹¿å‘Šç›´æ¥è®¿é—®ä¿®å¤åŠŸèƒ½å¯ç”¨');
                } else {
                    fixTest.testResults.push('âŒ è°·æ­Œå¹¿å‘Šç›´æ¥è®¿é—®ä¿®å¤åŠŸèƒ½ä¸å¯ç”¨');
                }
                
                result.innerHTML = JSON.stringify(fixTest, null, 2);
                result.className = 'result success';
            } catch (error) {
                result.innerHTML = `æµ‹è¯•å¤±è´¥: ${error.message}`;
                result.className = 'result error';
            }
        }
        
        // æ¨¡æ‹Ÿç›´æ¥è®¿é—®
        function simulateDirectAccess() {
            const result = document.getElementById('fix-test');
            result.innerHTML = 'æ­£åœ¨æ¨¡æ‹Ÿç›´æ¥è®¿é—®...';
            
            try {
                // æ¸…é™¤referrerä¿¡æ¯ï¼ˆæ¨¡æ‹Ÿç›´æ¥è®¿é—®ï¼‰
                Object.defineProperty(document, 'referrer', {
                    get: function() { return ''; },
                    configurable: true
                });
                
                // æ¨¡æ‹Ÿé¡µé¢é‡æ–°åŠ è½½
                const simulation = {
                    message: 'å·²æ¨¡æ‹Ÿç›´æ¥è®¿é—®åœºæ™¯',
                    referrer: document.referrer,
                    timestamp: new Date().toISOString(),
                    nextSteps: [
                        '1. åˆ·æ–°é¡µé¢æŸ¥çœ‹æ•ˆæœ',
                        '2. æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—',
                        '3. è§‚å¯Ÿé¡µé¢åŠ è½½è¡Œä¸º'
                    ]
                };
                
                result.innerHTML = JSON.stringify(simulation, null, 2);
                result.className = 'result warning';
                
                // 3ç§’åæç¤ºåˆ·æ–°
                setTimeout(() => {
                    if (confirm('æ¨¡æ‹Ÿå®Œæˆï¼å»ºè®®åˆ·æ–°é¡µé¢æŸ¥çœ‹æ•ˆæœã€‚æ˜¯å¦ç°åœ¨åˆ·æ–°ï¼Ÿ')) {
                        window.location.reload();
                    }
                }, 3000);
                
            } catch (error) {
                result.innerHTML = `æ¨¡æ‹Ÿå¤±è´¥: ${error.message}`;
                result.className = 'result error';
            }
        }
        
        // ç”Ÿæˆç»¼åˆæŠ¥å‘Š
        function generateComprehensiveReport() {
            const result = document.getElementById('comprehensive-report');
            result.innerHTML = 'æ­£åœ¨ç”Ÿæˆç»¼åˆæŠ¥å‘Š...';
            
            try {
                const report = {
                    timestamp: new Date().toISOString(),
                    device: {
                        userAgent: navigator.userAgent,
                        platform: navigator.platform,
                        screenSize: `${window.screen.width}x${window.screen.height}`,
                        viewportSize: `${window.innerWidth}x${window.innerHeight}`,
                        pixelRatio: window.devicePixelRatio || 1,
                        touchSupport: 'ontouchstart' in window
                    },
                    network: {
                        onLine: navigator.onLine,
                        connection: navigator.connection ? {
                            effectiveType: navigator.connection.effectiveType,
                            downlink: navigator.connection.downlink
                        } : 'Not supported'
                    },
                    access: {
                        referrer: document.referrer || 'Direct access',
                        url: window.location.href,
                        isDirectAccess: !document.referrer,
                        isGoogleAds: document.referrer && document.referrer.includes('google')
                    },
                    performance: {
                        readyState: document.readyState,
                        loadTime: performance.timing ? 
                            performance.timing.loadEventEnd - performance.timing.navigationStart : 'Not available'
                    },
                    recommendations: []
                };
                
                // ç”Ÿæˆå»ºè®®
                if (report.access.isDirectAccess) {
                    report.recommendations.push('æ£€æµ‹åˆ°ç›´æ¥è®¿é—®ï¼Œå»ºè®®å¯ç”¨ä¿®å¤åŠŸèƒ½');
                }
                
                if (report.device.touchSupport) {
                    report.recommendations.push('è§¦æ‘¸è®¾å¤‡ï¼Œå»ºè®®ä¼˜åŒ–è§¦æ‘¸ä½“éªŒ');
                }
                
                if (report.network.connection === 'Not supported') {
                    report.recommendations.push('ç½‘ç»œä¿¡æ¯ä¸å¯ç”¨ï¼Œå¯èƒ½å½±å“æ€§èƒ½ä¼˜åŒ–');
                }
                
                result.innerHTML = JSON.stringify(report, null, 2);
                result.className = 'result success';
                
            } catch (error) {
                result.innerHTML = `ç”Ÿæˆå¤±è´¥: ${error.message}`;
                result.className = 'result error';
            }
        }
        
        // å¯¼å‡ºæŠ¥å‘Š
        function exportReport() {
            const result = document.getElementById('comprehensive-report');
            if (result.innerHTML === 'ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ç”ŸæˆæŠ¥å‘Š...') {
                alert('è¯·å…ˆç”ŸæˆæŠ¥å‘Šå†å¯¼å‡º');
                return;
            }
            
            try {
                const reportData = result.innerHTML;
                const blob = new Blob([reportData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `mobile-diagnosis-report-${new Date().toISOString().slice(0, 19)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert('æŠ¥å‘Šå·²å¯¼å‡ºï¼');
            } catch (error) {
                alert('å¯¼å‡ºå¤±è´¥: ' + error.message);
            }
        }
        
        // å¯¼èˆªåŠŸèƒ½
        function goToHome() {
            window.location.href = '/';
        }
        
        function goToServices() {
            window.location.href = '/services';
        }
        
        function goToContact() {
            window.location.href = '/contact';
        }
        
        function refreshPage() {
            window.location.reload();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æµ‹
        window.addEventListener('load', function() {
            console.log('ğŸ”§ ç§»åŠ¨ç«¯æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            
            // è‡ªåŠ¨æ£€æµ‹è®¾å¤‡ä¿¡æ¯
            setTimeout(() => {
                checkDeviceInfo();
            }, 1000);
        });
    </script>
</body>
</html>
