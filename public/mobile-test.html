<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§»åŠ¨ç«¯è¯Šæ–­æµ‹è¯• - FatePath</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: white;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 10px;
        }
        
        .test-section {
            background: #2a2a2a;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #fbbf24;
        }
        
        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #3a3a3a;
        }
        
        .test-item:last-child {
            border-bottom: none;
        }
        
        .status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status.pass {
            background: #10b981;
            color: white;
        }
        
        .status.fail {
            background: #ef4444;
            color: white;
        }
        
        .status.warning {
            background: #f59e0b;
            color: white;
        }
        
        .btn {
            background: #fbbf24;
            color: #1a1a1a;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: background 0.2s;
        }
        
        .btn:hover {
            background: #f59e0b;
        }
        
        .btn:disabled {
            background: #6b7280;
            cursor: not-allowed;
        }
        
        .log {
            background: #1a1a1a;
            border: 1px solid #3a3a3a;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .device-info {
            background: #1a1a1a;
            border: 1px solid #3a3a3a;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .device-info h3 {
            margin-bottom: 10px;
            color: #fbbf24;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .info-item {
            padding: 8px;
            background: #2a2a2a;
            border-radius: 4px;
        }
        
        .info-label {
            font-size: 12px;
            color: #9ca3af;
            margin-bottom: 4px;
        }
        
        .info-value {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“± ç§»åŠ¨ç«¯è¯Šæ–­æµ‹è¯•</h1>
            <p>FatePath ç§»åŠ¨ç«¯å…¼å®¹æ€§æ£€æµ‹å·¥å…·</p>
        </div>

        <div class="test-section">
            <h2>ğŸ” åŸºç¡€åŠŸèƒ½æµ‹è¯•</h2>
            <div class="test-item">
                <span>JavaScript æ”¯æŒ</span>
                <span class="status pass" id="js-test">é€šè¿‡</span>
            </div>
            <div class="test-item">
                <span>DOM æ”¯æŒ</span>
                <span class="status pass" id="dom-test">é€šè¿‡</span>
            </div>
            <div class="test-item">
                <span>è§¦æ‘¸äº‹ä»¶</span>
                <span class="status" id="touch-test">æ£€æµ‹ä¸­...</span>
            </div>
            <div class="test-item">
                <span>è§†å£å¤§å°</span>
                <span class="status" id="viewport-test">æ£€æµ‹ä¸­...</span>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸŒ ç½‘ç»œå’Œæ€§èƒ½æµ‹è¯•</h2>
            <div class="test-item">
                <span>ç½‘ç»œè¿æ¥</span>
                <span class="status" id="network-test">æ£€æµ‹ä¸­...</span>
            </div>
            <div class="test-item">
                <span>é¡µé¢åŠ è½½æ—¶é—´</span>
                <span class="status" id="load-test">æ£€æµ‹ä¸­...</span>
            </div>
            <div class="test-item">
                <span>å†…å­˜ä½¿ç”¨</span>
                <span class="status" id="memory-test">æ£€æµ‹ä¸­...</span>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ“± è®¾å¤‡ä¿¡æ¯</h2>
            <div class="device-info">
                <h3>è®¾å¤‡è¯¦æƒ…</h3>
                <div class="info-grid" id="device-grid">
                    <!-- è®¾å¤‡ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ› ï¸ è¯Šæ–­å·¥å…·</h2>
            <button class="btn" onclick="runFullDiagnostics()">è¿è¡Œå®Œæ•´è¯Šæ–­</button>
            <button class="btn" onclick="exportReport()">å¯¼å‡ºè¯Šæ–­æŠ¥å‘Š</button>
            <button class="btn" onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
            <button class="btn" onclick="testMainApp()">æµ‹è¯•ä¸»åº”ç”¨</button>
        </div>

        <div class="test-section">
            <h2>ğŸ“‹ è¯Šæ–­æ—¥å¿—</h2>
            <div class="log" id="diagnostic-log">
                <div>ç­‰å¾…è¯Šæ–­å¼€å§‹...</div>
            </div>
        </div>
    </div>

    <script>
        // è¯Šæ–­æ—¥å¿—
        const log = document.getElementById('diagnostic-log');
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.color = type === 'error' ? '#ef4444' : type === 'warning' ? '#f59e0b' : '#10b981';
            logEntry.textContent = `[${timestamp}] ${message}`;
            log.appendChild(logEntry);
            log.scrollTop = log.scrollHeight;
        }

        function clearLog() {
            log.innerHTML = '<div>æ—¥å¿—å·²æ¸…é™¤</div>';
        }

        // åŸºç¡€åŠŸèƒ½æµ‹è¯•
        function runBasicTests() {
            addLog('å¼€å§‹åŸºç¡€åŠŸèƒ½æµ‹è¯•...');
            
            // JavaScript æµ‹è¯•
            try {
                eval('const test = 1 + 1;');
                document.getElementById('js-test').textContent = 'é€šè¿‡';
                addLog('âœ… JavaScript æ”¯æŒæ­£å¸¸');
            } catch (error) {
                document.getElementById('js-test').textContent = 'å¤±è´¥';
                document.getElementById('js-test').className = 'status fail';
                addLog('âŒ JavaScript æ”¯æŒå¼‚å¸¸', 'error');
            }

            // DOM æµ‹è¯•
            try {
                const testElement = document.createElement('div');
                document.body.appendChild(testElement);
                document.body.removeChild(testElement);
                document.getElementById('dom-test').textContent = 'é€šè¿‡';
                addLog('âœ… DOM æ”¯æŒæ­£å¸¸');
            } catch (error) {
                document.getElementById('dom-test').textContent = 'å¤±è´¥';
                document.getElementById('dom-test').className = 'status fail';
                addLog('âŒ DOM æ”¯æŒå¼‚å¸¸', 'error');
            }

            // è§¦æ‘¸äº‹ä»¶æµ‹è¯•
            if ('ontouchstart' in window) {
                document.getElementById('touch-test').textContent = 'æ”¯æŒ';
                document.getElementById('touch-test').className = 'status pass';
                addLog('âœ… è§¦æ‘¸äº‹ä»¶æ”¯æŒæ­£å¸¸');
            } else {
                document.getElementById('touch-test').textContent = 'ä¸æ”¯æŒ';
                document.getElementById('touch-test').className = 'status warning';
                addLog('âš ï¸ è§¦æ‘¸äº‹ä»¶ä¸æ”¯æŒ', 'warning');
            }

            // è§†å£æµ‹è¯•
            if (window.innerWidth > 0 && window.innerHeight > 0) {
                document.getElementById('viewport-test').textContent = 'æ­£å¸¸';
                document.getElementById('viewport-test').className = 'status pass';
                addLog(`âœ… è§†å£å¤§å°: ${window.innerWidth}x${window.innerHeight}`);
            } else {
                document.getElementById('viewport-test').textContent = 'å¼‚å¸¸';
                document.getElementById('viewport-test').className = 'status fail';
                addLog('âŒ è§†å£å¤§å°å¼‚å¸¸', 'error');
            }
        }

        // ç½‘ç»œå’Œæ€§èƒ½æµ‹è¯•
        function runNetworkTests() {
            addLog('å¼€å§‹ç½‘ç»œå’Œæ€§èƒ½æµ‹è¯•...');
            
            // ç½‘ç»œè¿æ¥æµ‹è¯•
            if (navigator.onLine) {
                document.getElementById('network-test').textContent = 'åœ¨çº¿';
                document.getElementById('network-test').className = 'status pass';
                addLog('âœ… ç½‘ç»œè¿æ¥æ­£å¸¸');
            } else {
                document.getElementById('network-test').textContent = 'ç¦»çº¿';
                document.getElementById('network-test').className = 'status fail';
                addLog('âŒ ç½‘ç»œè¿æ¥å¼‚å¸¸', 'error');
            }

            // é¡µé¢åŠ è½½æ—¶é—´æµ‹è¯•
            if (performance && performance.timing) {
                const loadTime = performance.timing.loadEventEnd - performance.timing.loadEventStart;
                if (loadTime > 0) {
                    document.getElementById('load-test').textContent = `${loadTime}ms`;
                    document.getElementById('load-test').className = loadTime < 3000 ? 'status pass' : 'status warning';
                    addLog(`ğŸ“Š é¡µé¢åŠ è½½æ—¶é—´: ${loadTime}ms`);
                } else {
                    document.getElementById('load-test').textContent = 'æ£€æµ‹ä¸­...';
                    addLog('â³ é¡µé¢åŠ è½½æ—¶é—´æ£€æµ‹ä¸­...');
                }
            } else {
                document.getElementById('load-test').textContent = 'ä¸æ”¯æŒ';
                document.getElementById('load-test').className = 'status warning';
                addLog('âš ï¸ æ€§èƒ½APIä¸æ”¯æŒ', 'warning');
            }

            // å†…å­˜ä½¿ç”¨æµ‹è¯•
            if (performance && performance.memory) {
                const memory = performance.memory;
                const usedMB = Math.round(memory.usedJSHeapSize / 1024 / 1024);
                const totalMB = Math.round(memory.totalJSHeapSize / 1024 / 1024);
                document.getElementById('memory-test').textContent = `${usedMB}MB/${totalMB}MB`;
                document.getElementById('memory-test').className = 'status pass';
                addLog(`ğŸ’¾ å†…å­˜ä½¿ç”¨: ${usedMB}MB / ${totalMB}MB`);
            } else {
                document.getElementById('memory-test').textContent = 'ä¸æ”¯æŒ';
                document.getElementById('memory-test').className = 'status warning';
                addLog('âš ï¸ å†…å­˜APIä¸æ”¯æŒ', 'warning');
            }
        }

        // æ”¶é›†è®¾å¤‡ä¿¡æ¯
        function collectDeviceInfo() {
            addLog('æ”¶é›†è®¾å¤‡ä¿¡æ¯...');
            
            const deviceInfo = {
                'ç”¨æˆ·ä»£ç†': navigator.userAgent,
                'å¹³å°': navigator.platform,
                'è¯­è¨€': navigator.language,
                'Cookie': navigator.cookieEnabled ? 'å¯ç”¨' : 'ç¦ç”¨',
                'å±å¹•å°ºå¯¸': `${window.screen.width}x${window.screen.height}`,
                'è§†å£å°ºå¯¸': `${window.innerWidth}x${window.innerHeight}`,
                'åƒç´ æ¯”': window.devicePixelRatio || 1,
                'å†…å­˜': navigator.deviceMemory ? `${navigator.deviceMemory}GB` : 'æœªçŸ¥',
                'CPUæ ¸å¿ƒ': navigator.hardwareConcurrency || 'æœªçŸ¥',
                'è§¦æ‘¸æ”¯æŒ': 'ontouchstart' in window ? 'æ˜¯' : 'å¦',
                'æ–¹å‘': window.screen.orientation ? window.screen.orientation.type : 'æœªçŸ¥'
            };

            const deviceGrid = document.getElementById('device-grid');
            deviceGrid.innerHTML = '';

            Object.entries(deviceInfo).forEach(([label, value]) => {
                const infoItem = document.createElement('div');
                infoItem.className = 'info-item';
                infoItem.innerHTML = `
                    <div class="info-label">${label}</div>
                    <div class="info-value">${value}</div>
                `;
                deviceGrid.appendChild(infoItem);
            });

            addLog('âœ… è®¾å¤‡ä¿¡æ¯æ”¶é›†å®Œæˆ');
        }

        // è¿è¡Œå®Œæ•´è¯Šæ–­
        async function runFullDiagnostics() {
            addLog('ğŸš€ å¼€å§‹å®Œæ•´è¯Šæ–­...');
            
            try {
                // åŸºç¡€æµ‹è¯•
                runBasicTests();
                
                // ç½‘ç»œæµ‹è¯•
                runNetworkTests();
                
                // è®¾å¤‡ä¿¡æ¯
                collectDeviceInfo();
                
                // å…¼å®¹æ€§æµ‹è¯•
                await runCompatibilityTests();
                
                addLog('âœ… å®Œæ•´è¯Šæ–­å®Œæˆ');
            } catch (error) {
                addLog(`âŒ è¯Šæ–­è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯: ${error.message}`, 'error');
            }
        }

        // å…¼å®¹æ€§æµ‹è¯•
        async function runCompatibilityTests() {
            addLog('å¼€å§‹å…¼å®¹æ€§æµ‹è¯•...');
            
            const tests = [
                { name: 'ES6 Promise', test: () => typeof Promise !== 'undefined' },
                { name: 'Fetch API', test: () => typeof fetch !== 'undefined' },
                { name: 'Service Worker', test: () => 'serviceWorker' in navigator },
                { name: 'WebGL', test: () => !!window.WebGLRenderingContext },
                { name: 'Local Storage', test: () => !!window.localStorage },
                { name: 'Session Storage', test: () => !!window.sessionStorage },
                { name: 'IndexedDB', test: () => !!window.indexedDB },
                { name: 'Web Workers', test: () => !!window.Worker },
                { name: 'Geolocation', test: () => !!navigator.geolocation },
                { name: 'Notifications', test: () => !!window.Notification }
            ];

            for (const test of tests) {
                try {
                    const result = test.test();
                    addLog(`${result ? 'âœ…' : 'âŒ'} ${test.name}: ${result ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}`);
                } catch (error) {
                    addLog(`âŒ ${test.name}: æµ‹è¯•å¤±è´¥ - ${error.message}`, 'error');
                }
            }
        }

        // å¯¼å‡ºè¯Šæ–­æŠ¥å‘Š
        function exportReport() {
            addLog('å¯¼å‡ºè¯Šæ–­æŠ¥å‘Š...');
            
            const report = {
                timestamp: new Date().toISOString(),
                url: window.location.href,
                userAgent: navigator.userAgent,
                screenSize: `${window.screen.width}x${window.screen.height}`,
                viewportSize: `${window.innerWidth}x${window.innerHeight}`,
                tests: {
                    javascript: document.getElementById('js-test').textContent,
                    dom: document.getElementById('dom-test').textContent,
                    touch: document.getElementById('touch-test').textContent,
                    viewport: document.getElementById('viewport-test').textContent,
                    network: document.getElementById('network-test').textContent,
                    loadTime: document.getElementById('load-test').textContent,
                    memory: document.getElementById('memory-test').textContent
                }
            };

            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `mobile-diagnostics-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            addLog('âœ… è¯Šæ–­æŠ¥å‘Šå·²å¯¼å‡º');
        }

        // æµ‹è¯•ä¸»åº”ç”¨
        function testMainApp() {
            addLog('æµ‹è¯•ä¸»åº”ç”¨...');
            
            try {
                // å°è¯•åŠ è½½ä¸»åº”ç”¨çš„è„šæœ¬
                const script = document.createElement('script');
                script.src = '/src/main.jsx';
                script.onload = () => {
                    addLog('âœ… ä¸»åº”ç”¨è„šæœ¬åŠ è½½æˆåŠŸ');
                };
                script.onerror = () => {
                    addLog('âŒ ä¸»åº”ç”¨è„šæœ¬åŠ è½½å¤±è´¥', 'error');
                };
                document.head.appendChild(script);
            } catch (error) {
                addLog(`âŒ ä¸»åº”ç”¨æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        window.addEventListener('load', () => {
            addLog('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è‡ªåŠ¨æµ‹è¯•...');
            setTimeout(() => {
                runBasicTests();
                runNetworkTests();
                collectDeviceInfo();
            }, 1000);
        });

        // è§¦æ‘¸äº‹ä»¶æµ‹è¯•
        document.addEventListener('touchstart', () => {
            if (document.getElementById('touch-test').textContent === 'æ£€æµ‹ä¸­...') {
                document.getElementById('touch-test').textContent = 'æ”¯æŒ';
                document.getElementById('touch-test').className = 'status pass';
                addLog('âœ… è§¦æ‘¸äº‹ä»¶æ£€æµ‹æˆåŠŸ');
            }
        });

        // ç½‘ç»œçŠ¶æ€å˜åŒ–ç›‘å¬
        window.addEventListener('online', () => {
            addLog('ğŸŒ ç½‘ç»œè¿æ¥å·²æ¢å¤');
            if (document.getElementById('network-test')) {
                document.getElementById('network-test').textContent = 'åœ¨çº¿';
                document.getElementById('network-test').className = 'status pass';
            }
        });

        window.addEventListener('offline', () => {
            addLog('ğŸŒ ç½‘ç»œè¿æ¥å·²æ–­å¼€', 'warning');
            if (document.getElementById('network-test')) {
                document.getElementById('network-test').textContent = 'ç¦»çº¿';
                document.getElementById('network-test').className = 'status fail';
            }
        });
    </script>
</body>
</html>
