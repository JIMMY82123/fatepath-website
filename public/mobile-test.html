<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>移动端测试页面 - FatePath</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
            line-height: 1.6;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 10px;
        }
        
        .header h1 {
            color: #fbbf24;
            margin-bottom: 10px;
        }
        
        .test-section {
            background: #2a2a2a;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 10px;
        }
        
        .test-section h2 {
            color: #fbbf24;
            margin-bottom: 15px;
            border-bottom: 2px solid #fbbf24;
            padding-bottom: 10px;
        }
        
        .test-button {
            background: #fbbf24;
            color: #1a1a1a;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            background: #f59e0b;
            transform: translateY(-2px);
        }
        
        .test-button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            background: #333;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .success { border-left: 4px solid #10b981; }
        .warning { border-left: 4px solid #f59e0b; }
        .error { border-left: 4px solid #ef4444; }
        
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status.success { background: #10b981; color: white; }
        .status.warning { background: #f59e0b; color: white; }
        .status.error { background: #ef4444; color: white; }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .info-item {
            background: #333;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }
        
        .info-item strong {
            color: #fbbf24;
            display: block;
            margin-bottom: 5px;
        }
        
        @media (max-width: 768px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .test-button {
                width: 100%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔧 移动端问题诊断工具</h1>
            <p>专门用于测试和修复谷歌广告直接访问问题</p>
        </div>
        
        <div class="test-section">
            <h2>📱 设备信息检测</h2>
            <div id="device-info" class="result">
                点击下方按钮开始检测...
            </div>
            <button class="test-button" onclick="checkDeviceInfo()">检测设备信息</button>
        </div>
        
        <div class="test-section">
            <h2>🌐 网络和性能检测</h2>
            <div id="network-info" class="result">
                点击下方按钮开始检测...
            </div>
            <button class="test-button" onclick="checkNetworkInfo()">检测网络性能</button>
        </div>
        
        <div class="test-section">
            <h2>🔍 访问来源检测</h2>
            <div id="referrer-info" class="result">
                点击下方按钮开始检测...
            </div>
            <button class="test-button" onclick="checkReferrerInfo()">检测访问来源</button>
        </div>
        
        <div class="test-section">
            <h2>⚡ 页面加载测试</h2>
            <div id="loading-test" class="result">
                点击下方按钮开始测试...
            </div>
            <button class="test-button" onclick="testPageLoading()">测试页面加载</button>
        </div>
        
        <div class="test-section">
            <h2>🛠️ 修复功能测试</h2>
            <div id="fix-test" class="result">
                点击下方按钮开始测试...
            </div>
            <button class="test-button" onclick="testFixFunctions()">测试修复功能</button>
            <button class="test-button" onclick="simulateDirectAccess()">模拟直接访问</button>
        </div>
        
        <div class="test-section">
            <h2>📊 综合诊断报告</h2>
            <div id="comprehensive-report" class="result">
                点击下方按钮生成报告...
            </div>
            <button class="test-button" onclick="generateComprehensiveReport()">生成综合报告</button>
            <button class="test-button" onclick="exportReport()">导出报告</button>
        </div>
        
        <div class="test-section">
            <h2>🔗 快速导航</h2>
            <button class="test-button" onclick="goToHome()">前往主页</button>
            <button class="test-button" onclick="goToServices()">前往服务页面</button>
            <button class="test-button" onclick="goToContact()">前往联系页面</button>
            <button class="test-button" onclick="refreshPage()">刷新页面</button>
        </div>
    </div>

    <script>
        // 设备信息检测
        function checkDeviceInfo() {
            const result = document.getElementById('device-info');
            result.innerHTML = '正在检测设备信息...';
            
            try {
                const deviceInfo = {
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    language: navigator.language,
                    cookieEnabled: navigator.cookieEnabled,
                    onLine: navigator.onLine,
                    screenSize: `${window.screen.width}x${window.screen.height}`,
                    viewportSize: `${window.innerWidth}x${window.innerHeight}`,
                    pixelRatio: window.devicePixelRatio || 1,
                    memory: navigator.deviceMemory || 'unknown',
                    cores: navigator.hardwareConcurrency || 'unknown',
                    touchSupport: 'ontouchstart' in window,
                    orientation: window.screen.orientation?.type || 'unknown'
                };
                
                result.innerHTML = JSON.stringify(deviceInfo, null, 2);
                result.className = 'result success';
            } catch (error) {
                result.innerHTML = `检测失败: ${error.message}`;
                result.className = 'result error';
            }
        }
        
        // 网络和性能检测
        function checkNetworkInfo() {
            const result = document.getElementById('network-info');
            result.innerHTML = '正在检测网络信息...';
            
            try {
                const networkInfo = {
                    connection: navigator.connection ? {
                        effectiveType: navigator.connection.effectiveType,
                        downlink: navigator.connection.downlink,
                        rtt: navigator.connection.rtt,
                        saveData: navigator.connection.saveData
                    } : 'Not supported',
                    performance: {
                        navigationStart: performance.timing?.navigationStart || 'Not available',
                        loadEventEnd: performance.timing?.loadEventEnd || 'Not available',
                        domContentLoaded: performance.timing?.domContentLoadedEventEnd || 'Not available'
                    },
                    memory: performance.memory ? {
                        usedJSHeapSize: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024) + ' MB',
                        totalJSHeapSize: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024) + ' MB',
                        jsHeapSizeLimit: Math.round(performance.memory.jsHeapSizeLimit / 1024 / 1024) + ' MB'
                    } : 'Not available'
                };
                
                result.innerHTML = JSON.stringify(networkInfo, null, 2);
                result.className = 'result success';
            } catch (error) {
                result.innerHTML = `检测失败: ${error.message}`;
                result.className = 'result error';
            }
        }
        
        // 访问来源检测
        function checkReferrerInfo() {
            const result = document.getElementById('referrer-info');
            result.innerHTML = '正在检测访问来源...';
            
            try {
                const referrerInfo = {
                    referrer: document.referrer || 'No referrer (direct access)',
                    url: window.location.href,
                    pathname: window.location.pathname,
                    search: window.location.search,
                    hash: window.location.hash,
                    timestamp: new Date().toISOString(),
                    isDirectAccess: !document.referrer,
                    isGoogleAds: document.referrer && (
                        document.referrer.includes('google.com') ||
                        document.referrer.includes('googleadservices.com') ||
                        document.referrer.includes('doubleclick.net') ||
                        document.referrer.includes('googlesyndication.com')
                    )
                };
                
                result.innerHTML = JSON.stringify(referrerInfo, null, 2);
                result.className = 'result success';
            } catch (error) {
                result.innerHTML = `检测失败: ${error.message}`;
                result.className = 'result error';
            }
        }
        
        // 页面加载测试
        function testPageLoading() {
            const result = document.getElementById('loading-test');
            result.innerHTML = '正在测试页面加载...';
            
            try {
                const startTime = performance.now();
                
                // 模拟页面加载测试
                setTimeout(() => {
                    const loadTime = performance.now() - startTime;
                    const loadInfo = {
                        loadTime: Math.round(loadTime) + ' ms',
                        domReady: document.readyState,
                        performance: {
                            navigationStart: performance.timing?.navigationStart || 'Not available',
                            loadEventEnd: performance.timing?.loadEventEnd || 'Not available'
                        },
                        resources: performance.getEntriesByType('resource').length,
                        recommendations: []
                    };
                    
                    if (loadTime > 3000) {
                        loadInfo.recommendations.push('页面加载时间较长，建议优化');
                    }
                    
                    if (document.readyState !== 'complete') {
                        loadInfo.recommendations.push('DOM未完全加载');
                    }
                    
                    result.innerHTML = JSON.stringify(loadInfo, null, 2);
                    result.className = loadInfo.recommendations.length > 0 ? 'result warning' : 'result success';
                }, 1000);
                
            } catch (error) {
                result.innerHTML = `测试失败: ${error.message}`;
                result.className = 'result error';
            }
        }
        
        // 修复功能测试
        function testFixFunctions() {
            const result = document.getElementById('fix-test');
            result.innerHTML = '正在测试修复功能...';
            
            try {
                const fixTest = {
                    mobileErrorBoundary: typeof MobileErrorBoundary !== 'undefined',
                    mobilePerformanceMonitor: typeof MobilePerformanceMonitor !== 'undefined',
                    mobileOptimization: typeof mobileOptimization !== 'undefined',
                    mobileDiagnostics: typeof mobileDiagnostics !== 'undefined',
                    fixGoogleAdsDirectAccess: typeof window.fixGoogleAdsDirectAccess !== 'undefined',
                    testResults: []
                };
                
                // 测试各种修复功能
                if (fixTest.mobileErrorBoundary) {
                    fixTest.testResults.push('✅ 移动端错误边界可用');
                } else {
                    fixTest.testResults.push('❌ 移动端错误边界不可用');
                }
                
                if (fixTest.fixGoogleAdsDirectAccess) {
                    fixTest.testResults.push('✅ 谷歌广告直接访问修复功能可用');
                } else {
                    fixTest.testResults.push('❌ 谷歌广告直接访问修复功能不可用');
                }
                
                result.innerHTML = JSON.stringify(fixTest, null, 2);
                result.className = 'result success';
            } catch (error) {
                result.innerHTML = `测试失败: ${error.message}`;
                result.className = 'result error';
            }
        }
        
        // 模拟直接访问
        function simulateDirectAccess() {
            const result = document.getElementById('fix-test');
            result.innerHTML = '正在模拟直接访问...';
            
            try {
                // 清除referrer信息（模拟直接访问）
                Object.defineProperty(document, 'referrer', {
                    get: function() { return ''; },
                    configurable: true
                });
                
                // 模拟页面重新加载
                const simulation = {
                    message: '已模拟直接访问场景',
                    referrer: document.referrer,
                    timestamp: new Date().toISOString(),
                    nextSteps: [
                        '1. 刷新页面查看效果',
                        '2. 检查控制台日志',
                        '3. 观察页面加载行为'
                    ]
                };
                
                result.innerHTML = JSON.stringify(simulation, null, 2);
                result.className = 'result warning';
                
                // 3秒后提示刷新
                setTimeout(() => {
                    if (confirm('模拟完成！建议刷新页面查看效果。是否现在刷新？')) {
                        window.location.reload();
                    }
                }, 3000);
                
            } catch (error) {
                result.innerHTML = `模拟失败: ${error.message}`;
                result.className = 'result error';
            }
        }
        
        // 生成综合报告
        function generateComprehensiveReport() {
            const result = document.getElementById('comprehensive-report');
            result.innerHTML = '正在生成综合报告...';
            
            try {
                const report = {
                    timestamp: new Date().toISOString(),
                    device: {
                        userAgent: navigator.userAgent,
                        platform: navigator.platform,
                        screenSize: `${window.screen.width}x${window.screen.height}`,
                        viewportSize: `${window.innerWidth}x${window.innerHeight}`,
                        pixelRatio: window.devicePixelRatio || 1,
                        touchSupport: 'ontouchstart' in window
                    },
                    network: {
                        onLine: navigator.onLine,
                        connection: navigator.connection ? {
                            effectiveType: navigator.connection.effectiveType,
                            downlink: navigator.connection.downlink
                        } : 'Not supported'
                    },
                    access: {
                        referrer: document.referrer || 'Direct access',
                        url: window.location.href,
                        isDirectAccess: !document.referrer,
                        isGoogleAds: document.referrer && document.referrer.includes('google')
                    },
                    performance: {
                        readyState: document.readyState,
                        loadTime: performance.timing ? 
                            performance.timing.loadEventEnd - performance.timing.navigationStart : 'Not available'
                    },
                    recommendations: []
                };
                
                // 生成建议
                if (report.access.isDirectAccess) {
                    report.recommendations.push('检测到直接访问，建议启用修复功能');
                }
                
                if (report.device.touchSupport) {
                    report.recommendations.push('触摸设备，建议优化触摸体验');
                }
                
                if (report.network.connection === 'Not supported') {
                    report.recommendations.push('网络信息不可用，可能影响性能优化');
                }
                
                result.innerHTML = JSON.stringify(report, null, 2);
                result.className = 'result success';
                
            } catch (error) {
                result.innerHTML = `生成失败: ${error.message}`;
                result.className = 'result error';
            }
        }
        
        // 导出报告
        function exportReport() {
            const result = document.getElementById('comprehensive-report');
            if (result.innerHTML === '点击下方按钮生成报告...') {
                alert('请先生成报告再导出');
                return;
            }
            
            try {
                const reportData = result.innerHTML;
                const blob = new Blob([reportData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `mobile-diagnosis-report-${new Date().toISOString().slice(0, 19)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert('报告已导出！');
            } catch (error) {
                alert('导出失败: ' + error.message);
            }
        }
        
        // 导航功能
        function goToHome() {
            window.location.href = '/';
        }
        
        function goToServices() {
            window.location.href = '/services';
        }
        
        function goToContact() {
            window.location.href = '/contact';
        }
        
        function refreshPage() {
            window.location.reload();
        }
        
        // 页面加载完成后自动检测
        window.addEventListener('load', function() {
            console.log('🔧 移动端测试页面加载完成');
            
            // 自动检测设备信息
            setTimeout(() => {
                checkDeviceInfo();
            }, 1000);
        });
    </script>
</body>
</html>
