<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- Favicon and App Icons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="/android-chrome-512x512.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- SEO and Search Engine Icons -->
    <meta name="msapplication-TileColor" content="#facc15" />
    <meta name="msapplication-TileImage" content="/android-chrome-192x192.svg" />
    <meta name="msapplication-config" content="/browserconfig.xml" />
    
    <title>FatePath - Professional BaZi Reading Service | Free Bazi Chart Analysis | Chinese Numerology Expert</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#facc15" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="FatePath" />
    <link rel="apple-touch-icon" href="/images/icons/icon-192x192.png" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="description" content="FatePath - Get your free BaZi chart analysis today! Professional Chinese numerology expert with 15+ years experience. BaZi reading for career guidance, love compatibility, wealth analysis. Online consultation worldwide." />
    <meta name="keywords" content="fatepath, bazi reading, free bazi chart analysis, chinese numerology expert, bazi career guidance, bazi love compatibility, bazi wealth analysis, online bazi consultation, bazi master consultation, traditional chinese numerology, bazi chart calculator, bazi relationship reading, bazi life path analysis" />
    <meta name="author" content="FatePath" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://fatepath.me/" />
    <meta property="og:title" content="FatePath - Professional BaZi Reading Service | Free Bazi Chart Analysis" />
    <meta property="og:description" content="FatePath - Get your free BaZi chart analysis today! Professional Chinese numerology expert with 15+ years experience. BaZi reading for career guidance, love compatibility, wealth analysis." />
    <meta property="og:image" content="https://fatepath.me/og-image.svg" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://fatepath.me/" />
    <meta property="twitter:title" content="FatePath - Professional BaZi Reading Service | Free Bazi Chart Analysis" />
    <meta property="twitter:description" content="FatePath - Get your free BaZi chart analysis today! Professional Chinese numerology expert with 15+ years experience. BaZi reading for career guidance, love compatibility, wealth analysis." />
    <meta property="twitter:image" content="https://fatepath.me/og-image.svg" />

    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    
    <!-- Fonts with display=swap for better performance -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700;800&family=Cinzel:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Preload critical resources -->
    <!-- 移除favicon预加载，避免控制台警告 -->
    
    <!-- Google Analytics - 延迟加载以避免阻塞移动端渲染 -->
    <script>
      // 延迟加载 Google Analytics
      setTimeout(() => {
        const script = document.createElement('script');
        script.src = 'https://www.googletagmanager.com/gtag/js?id=G-GCNP2F5NJC';
        script.async = true;
        script.onload = function() {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-GCNP2F5NJC', {
            'page_title': document.title,
            'page_location': window.location.href,
            'allow_google_signals': false,
            'allow_ad_personalization_signals': false,
            'anonymize_ip': true
          });
          
          // 开发环境调试
          if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            console.log('🔍 Google Analytics 已加载（开发模式）');
          }
        };
        document.head.appendChild(script);
      }, 2000); // 延迟2秒加载
    </script>
    
    <!-- Google Tag Manager - 延迟加载 -->
    <script>
      // 延迟加载 Google Tag Manager
      setTimeout(() => {
        const script = document.createElement('script');
        script.innerHTML = `
          (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
          new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
          j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
          'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
          })(window,document,'script','dataLayer','GTM-5623V8HV');
        `;
        document.head.appendChild(script);
      }, 3000); // 延迟3秒加载
    </script>
    <!-- End Google Tag Manager -->
    
    <!-- Google Ads Global Site Tag - 延迟加载 -->
    <script>
      // 延迟加载 Google Ads
      setTimeout(() => {
        const script = document.createElement('script');
        script.src = 'https://www.googletagmanager.com/gtag/js?id=AW-17430671654';
        script.async = true;
        script.onload = function() {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'AW-17430671654');
          
          // Google Ads 转化跟踪配置
          gtag('config', 'AW-17430671654', {
            'conversion_id': 'AW-17430671654',
            'conversion_label': 'e2eYCNWo1P4aEKbiy_dA'
          });
          
          // 开发环境调试
          if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            console.log('🔍 Google Ads 已加载（开发模式）');
            console.log('🎯 转化ID: AW-17430671654');
            console.log('🏷️ 转化标签: e2eYCNWo1P4aEKbiy_dA');
          }
        };
        document.head.appendChild(script);
      }, 4000); // 延迟4秒加载
    </script>
    
    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "ProfessionalService",
      "name": "FatePath",
      "alternateName": "Mystic Wisdom, FatePath BaZi Reading",
      "description": "FatePath - Professional BaZi reading, love compatibility analysis, and custom talismans based on ancient Chinese numerology and astrology.",
      "url": "https://fatepath.me",
      "logo": "https://fatepath.me/favicon.svg",
      "image": "https://fatepath.me/og-image.svg",
      "telephone": "+86-15914228258",
      "email": "chenxiao0801@hotmail.com",
             "address": {
         "@type": "PostalAddress",
         "addressCountry": "US"
       },
      "serviceType": ["BaZi Reading", "Chinese Numerology", "Love Compatibility Analysis", "Custom Talisman", "Spiritual Guidance"],
      "areaServed": "Worldwide",
      "priceRange": "$$",
      "currenciesAccepted": "USD, CNY",
      "paymentAccepted": "PayPal",
      "openingHours": "Mo-Su 09:00-21:00",
      "hasOfferCatalog": {
        "@type": "OfferCatalog",
        "name": "Mystic Services",
        "itemListElement": [
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Detailed Bazi Reading",
              "description": "Comprehensive life path analysis through Bazi (八字) analysis including personality, career, and life purpose"
            },
            "price": "38",
            "priceCurrency": "USD",
            "availability": "https://schema.org/InStock"
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Love Compatibility Reading",
              "description": "Relationship and partnership analysis through Bazi compatibility and Five Elements theory"
            },
            "price": "44",
            "priceCurrency": "USD",
            "availability": "https://schema.org/InStock"
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Custom Talisman",
              "description": "Personalized protection talisman crafted specifically for your unique birth chart"
            },
            "price": "129",
            "priceCurrency": "USD",
            "availability": "https://schema.org/InStock"
          }
        ]
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "5.0",
        "reviewCount": "50",
        "bestRating": "5",
        "worstRating": "1"
      },
      "review": [
        {
          "@type": "Review",
          "reviewRating": {
            "@type": "Rating",
            "ratingValue": "5",
            "bestRating": "5"
          },
          "author": {
            "@type": "Person",
            "name": "Sarah Johnson"
          },
          "reviewBody": "The BaZi report was incredibly accurate and helped me understand my career path better."
        }
      ]
    }
    </script>


  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript>
      <iframe 
        src="https://www.googletagmanager.com/ns.html?id=GTM-5623V8HV"
        height="0" 
        width="0" 
        style="display:none;visibility:hidden">
      </iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <div id="root"></div>
    
    <!-- 多浏览器兼容性优化脚本 -->
    <script>
      // 多浏览器兼容性优化和修复脚本
      (function() {
        console.log('🔧 启动多浏览器兼容性优化脚本...');
        
        // 浏览器检测
        function detectBrowser() {
          const userAgent = navigator.userAgent;
          const isChrome = /Chrome/.test(userAgent) && !/Edge/.test(userAgent);
          const isSafari = /Safari/.test(userAgent) && !/Chrome/.test(userAgent);
          const isFirefox = /Firefox/.test(userAgent);
          const isEdge = /Edge/.test(userAgent);
          const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
          
          return {
            isChrome,
            isSafari,
            isFirefox,
            isEdge,
            isMobile,
            userAgent
          };
        }
        
        // 检测是否为直接访问
        function isDirectAccess() {
          const referrer = document.referrer;
          return !referrer || 
                 referrer.includes('google.com') || 
                 referrer.includes('googleadservices.com') ||
                 referrer.includes('doubleclick.net') ||
                 referrer.includes('googlesyndication.com') ||
                 referrer.includes('bing.com') ||
                 referrer.includes('facebook.com') ||
                 referrer.includes('twitter.com') ||
                 referrer.includes('youtube.com') ||
                 referrer.includes('instagram.com');
        }
        
        // Safari特定优化
        function applySafariOptimizations() {
          console.log('🍎 应用Safari特定优化...');
          
          // Safari的WebKit优化
          if ('webkitRequestAnimationFrame' in window) {
            console.log('✅ 检测到WebKit，启用Safari优化');
          }
          
          // 强制重绘，解决Safari渲染问题
          setTimeout(() => {
            document.body.style.display = 'none';
            document.body.offsetHeight; // 触发重排
            document.body.style.display = '';
          }, 100);
        }
        
        // Chrome特定优化
        function applyChromeOptimizations() {
          console.log('🌐 应用Chrome特定优化...');
          
          // Chrome的性能优化
          if ('requestIdleCallback' in window) {
            console.log('✅ 检测到Chrome高级API，启用性能优化');
          }
          
          // Chrome特定的ES6模块加载优化
          if (typeof import === 'function') {
            console.log('✅ Chrome支持ES6动态导入');
            
            // 预加载关键资源
            const criticalResources = [
              '/src/main.jsx',
              '/src/App.jsx',
              '/src/pages/Home.jsx'
            ];
            
            criticalResources.forEach(resource => {
              const link = document.createElement('link');
              link.rel = 'prefetch';
              link.href = resource;
              document.head.appendChild(link);
            });
          }
          
          // Chrome的严格模式兼容性检查
          try {
            // 测试Chrome的严格模式支持
            eval('"use strict"; const testVar = 1;');
            console.log('✅ Chrome严格模式支持正常');
          } catch (error) {
            console.warn('⚠️ Chrome严格模式可能有问题:', error.message);
          }
          
          // Chrome的模块加载重试机制
          window.chromeModuleRetry = function(scriptSrc, maxRetries) {
            if (maxRetries === undefined) maxRetries = 3;
            
            return new Promise(function(resolve, reject) {
              var attempts = 0;
              
              function loadScript() {
                attempts++;
                console.log('🔄 Chrome模块加载尝试 ' + attempts + '/' + maxRetries + ': ' + scriptSrc);
                
                var script = document.createElement('script');
                script.type = 'module';
                script.src = scriptSrc;
                
                script.onload = function() {
                  console.log('✅ Chrome模块加载成功');
                  resolve();
                };
                
                script.onerror = function(error) {
                  console.error('❌ Chrome模块加载失败 (尝试 ' + attempts + '):', error);
                  
                  if (attempts < maxRetries) {
                    console.log('⏰ ' + (attempts * 1000) + 'ms 后重试...');
                    setTimeout(loadScript, attempts * 1000);
                  } else {
                    reject(new Error('Chrome模块加载失败，已重试 ' + maxRetries + ' 次'));
                  }
                };
                
                document.head.appendChild(script);
              }
              
              loadScript();
            });
          };
          
          console.log('✅ Chrome特定优化完成');
        }
        
        // Firefox特定优化
        function applyFirefoxOptimizations() {
          console.log('🦊 应用Firefox特定优化...');
          
          // Firefox的Gecko引擎优化
          if ('mozRequestAnimationFrame' in window) {
            console.log('✅ 检测到Gecko，启用Firefox优化');
          }
        }
        
        // Edge特定优化
        function applyEdgeOptimizations() {
          console.log('🔷 应用Edge特定优化...');
          
          // Edge的Blink引擎优化
          if ('msRequestAnimationFrame' in window) {
            console.log('✅ 检测到Edge，启用Edge优化');
          }
        }
        
        // 通用移动端优化
        function applyMobileOptimizations() {
          console.log('📱 应用移动端通用优化...');
          
          // 触摸事件优化
          if ('ontouchstart' in window) {
            document.documentElement.style.touchAction = 'manipulation';
          }
          
          // 视口优化
          const viewport = document.querySelector('meta[name="viewport"]');
          if (viewport) {
            viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
          }
        }
        
        // 页面加载状态监控
        function monitorPageLoad() {
          const root = document.getElementById('root');
          let loadAttempts = 0;
          const maxAttempts = 3;
          
          function checkPageLoad() {
            if (root && root.children.length > 0) {
              console.log('✅ 页面加载成功');
              return;
            }
            
            loadAttempts++;
            if (loadAttempts < maxAttempts) {
              console.log(`⚠️ 页面加载检查 ${loadAttempts}/${maxAttempts}`);
              setTimeout(checkPageLoad, 2000);
            } else {
              console.log('❌ 页面加载失败，显示错误提示');
              showErrorPrompt();
            }
          }
          
          // 延迟检查，给React应用足够时间加载
          setTimeout(checkPageLoad, 3000);
        }
        
        // 显示错误提示
        function showErrorPrompt() {
          const errorDiv = document.createElement('div');
          errorDiv.id = 'browser-error-prompt';
          errorDiv.innerHTML = `
            <div style="
              position: fixed;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              background: rgba(26, 26, 26, 0.95);
              color: white;
              padding: 25px;
              border-radius: 12px;
              text-align: center;
              z-index: 9999;
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
              max-width: 350px;
              backdrop-filter: blur(15px);
              border: 1px solid #fbbf24;
            ">
              <h3 style="color: #fbbf24; margin: 0 0 15px 0; font-size: 1.3rem;">页面加载问题</h3>
              <p style="margin: 0 0 20px 0; font-size: 0.95rem; line-height: 1.5;">
                检测到浏览器兼容性问题，建议：
              </p>
              <ul style="text-align: left; margin: 0 0 20px 0; padding-left: 20px; font-size: 0.9rem;">
                <li>清除浏览器缓存</li>
                <li>刷新页面重试</li>
                <li>尝试其他浏览器</li>
              </ul>
              <div style="display: flex; gap: 10px; justify-content: center;">
                <button onclick="window.location.reload()" style="
                  background: #fbbf24;
                  color: #1a1a1a;
                  border: none;
                  padding: 10px 18px;
                  border-radius: 6px;
                  font-weight: 600;
                  cursor: pointer;
                  font-size: 0.9rem;
                ">刷新页面</button>
                <button onclick="this.parentElement.parentElement.parentElement.remove()" style="
                  background: #374151;
                  color: white;
                  border: none;
                  padding: 10px 18px;
                  border-radius: 6px;
                  font-weight: 600;
                  cursor: pointer;
                  font-size: 0.9rem;
                ">关闭</button>
              </div>
            </div>
          `;
          
          document.body.appendChild(errorDiv);
          
          // 10秒后自动移除
          setTimeout(() => {
            const prompt = document.getElementById('browser-error-prompt');
            if (prompt) prompt.remove();
          }, 10000);
        }
        
        // 主优化逻辑
        function applyBrowserOptimizations() {
          const browser = detectBrowser();
          console.log('🔍 检测到浏览器:', {
            Chrome: browser.isChrome,
            Safari: browser.isSafari,
            Firefox: browser.isFirefox,
            Edge: browser.isEdge,
            Mobile: browser.isMobile
          });
          
          // 应用浏览器特定优化
          if (browser.isSafari) {
            applySafariOptimizations();
          } else if (browser.isChrome) {
            applyChromeOptimizations();
          } else if (browser.isFirefox) {
            applyFirefoxOptimizations();
          } else if (browser.isEdge) {
            applyEdgeOptimizations();
          }
          
          // 移动端优化
          if (browser.isMobile) {
            applyMobileOptimizations();
          }
          
          // 监控页面加载
          monitorPageLoad();
        }
        
        // 执行优化
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', applyBrowserOptimizations);
        } else {
          applyBrowserOptimizations();
        }
        
        // 导出函数供外部使用
        window.applyBrowserOptimizations = applyBrowserOptimizations;
        window.detectBrowser = detectBrowser;
        
        console.log('✅ 多浏览器兼容性优化脚本初始化完成');
        
      })();
    </script>
    
    <!-- 主应用脚本 -->
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html> 